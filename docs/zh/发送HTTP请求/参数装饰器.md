# 参数装饰器

## @QueryParams

### 基本使用

`@QueryParams` 装饰器用于将参数对象转换为查询字符串。如下所示：

```ts {5-6,9}
@HttpApi({
  baseURL: 'http://localhost:3000/users/',
})
class UserApi {
  @Get('/pages')
  getUserPages(@QueryParam('page') page: number, @QueryParam('size') size: number): any {}
}
const userApi = new UserApi();
// 最终请求地址为http://localhost:3000/users/pages?page=1&size=20
const { data } = await userApi.getUserPages(1, 20);
console.log(data);
```

::: warning 装饰器重复与冲突
`@QueryParams` 装饰器和 `@QueryParams`、`@BodyParams`、`@PathParams` 装饰器不能同时使用。也就是说不能出现以下情况：

```ts
getUserPages(@QueryParam('page1')@QueryParam('page') page: number): any {}
// 或者
getUserPages(@PathParam('id') @QueryParam('size') size: number): any {}
```

实时上`axios-plus`中大部分的装饰器都不能重复出现，否则会报错。

:::

### 多参数合并

`@QueryParams` 装饰器可以将多个同名参数对象合并为一个数组，这样做对于传入数组参数十分有用。如下所示：

```ts {5-6,9}
@HttpApi({
  baseURL: 'http://localhost:3000/users/',
})
class UserApi {
  @Get('/groups')
  getUserGroups(@QueryParam('ids') id1: number, @QueryParam('ids') id2: number): any {}
}
// 最终请求地址为http://localhost:3000/users/groups?ids[]=2&ids[]=1
const { data } = await userApi.getUserGroups(1, 2);
console.log(data);
```

## @PathParam

`@PathParam` 装饰器用于将参数对象转换为路径参数。如下所示：

```ts {5-6,9}
@HttpApi({
  baseURL: 'http://localhost:3000/users/',
})
class UserApi {
  @Get('/:id')
  getUserById(@PathParam('id') id: number): any {}
}
// 最终请求地址为http://localhost:3000/users/1
const { data: data3 } = await userApi.getUserById(1);
console.log(data);
```

上面的例子中，`@PathParam` 装饰器将 `id` 参数对象转换为路径参数 `1`。

## @BodyParam

### 基本使用

`@BodyParam` 装饰器用于收集参数作为请求体参数。如下所示：

```ts {5-6,9}
@HttpApi({
  baseURL: 'http://localhost:3000/users/',
})
class UserApi {
  @Post('/')
  createUser(@BodyParam('user') user: { name: string; age: number }): any {}
}
// 最终请求地址为http://localhost:3000/users/1
const { data } = await userApi.createUser({ name: 'test', age: 18 });
console.log(data);
```

::: tip 单个参数名省略
当 `@BodyParam` 装饰器只接收一个参数时，`data`对象会被拍平一层，如下所示：

```json
data:{
  "name": "test",
  "age": 18
}
// 而不是
data: {
  "user": {
    "name": "test",
    "age": 18
  }
}
```

所以单参数的时候`axios-plus`允许你不写参数名：

```ts
@Post('/')
createUser(@BodyParam() user: { name: string; age: number }): any {}
```

:::

### 多参数合并

当有多个参数时，`@BodyParam` 装饰器可以将多个同名参数对象合并为一个对象。如下所示：

```ts {7-8}
@HttpApi({
  baseURL: 'http://localhost:3000/users/',
})
class UserApi {
  @Post('/')
  createUser(
    @BodyParam('user') user: { name: string; age: number },
    @BodyParam('person') person: { sex: string },
  ): any {}
}
// body参数
const { data } = await userApi.createUser({ name: 'test', age: 18 }, { sex: '男' });
console.log(data);
```

最终`body`参数如下所示：

```json
{ "person": { "sex": "男" }, "user": { "name": "test", "age": 18 } }
```

::: warning 全省略参数
如果你两个参数都省略那么会合并为数组

```ts {3-4}
@Post('/')
createUser(
  @BodyParam() user: { name: string; age: number },
  @BodyParam() person: { sex: string },
```

最终结果为：

```json
[{ "sex": "男" }, { "name": "test", "age": 18 }]
```

:::

### 上传文件

当然你可以使用`@BodyParam`实现更加复杂的功能，比如文件上传

```ts {5-10}
@HttpApi({
  baseURL: 'http://localhost:3000/users/',
})
class UserApi {
  @Post({
    url: '/upload',
    headers: {
      'Content-Type': 'mutilpart/form-data',
    },
  })
  uploadFile(@BodyParam('file') file: FormData): any {}
}
```

::: tip headers 参数
由于`Body`中的数据是多样的，为了提示后端以何种方式解析你的`Body`数据，你需要显示设置`mime`类型，即你需要在 `headers` 中指定`Content-Type`为`mutilpart/form-data`。常见的`mime`类型如下表所示：

| MIME 类型                             | 用途                         | 示例场景                    |
| ------------------------------------- | ---------------------------- | --------------------------- |
| **text/html**                         | 网页渲染（<html>...</html>） | HTML 网页                   |
| **application/json**                  | JSON 数据                    | API 响应（{"name":"John"}） |
| **application/javascript**            | JavaScript 代码              | 前端脚本（app.js）          |
| **image/jpeg**                        | JPEG 图片                    | 照片（.jpg）                |
| **image/png**                         | PNG 图片                     | 透明背景图片（.png）        |
| **application/pdf**                   | PDF 文档                     | 电子书/合同（.pdf）         |
| **application/x-www-form-urlencoded** | 表单提交（键值对）           | name=John&age=30            |
| **multipart/form-data**               | 文件上传表单                 | <input type="file">         |
| **application/octet-stream**          | 任意二进制文件               | 下载文件（.exe，.zip）      |

:::
