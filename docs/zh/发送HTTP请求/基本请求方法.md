# HTTP 请求方法

## 介绍

`axios-plus` 封装了常见的 HTTP 请求方法装饰器，用于快速定义 API 接口，主要包括：

- 类装饰器：`@HttpApi`
- 方法装饰器：`@Get`、`@Post`、`@Put`、`@Delete`、`@Patch`、`@Options`、`@Head`

## @HttpApi

`@HttpApi` 是类级别的装饰器，用于定义 API 接口类的基础配置，作为该类中所有请求方法的公共配置。

### 配置选项

`@HttpApi` 支持的配置项（`HttpApiDecoratorConfig` 类型）：

| 配置项     | 类型            | 说明                                                                                                       |
| ---------- | --------------- | ---------------------------------------------------------------------------------------------------------- |
| `baseURL`  | `string`        | 基础请求路径，会与方法装饰器的 `url` 拼接                                                                  |
| `url`      | `string`        | 相对路径前缀，用于统一拼接在方法路径前                                                                     |
| `refAxios` | `AxiosInstance` | 自定义 axios 实例，类中所有方法默认使用此实例                                                              |
| `mock`     | `Object`        | 全局 mock 配置<br>- `on`: 是否开启 mock（布尔值）<br>- `condition`: 触发真实接口的条件（函数，返回布尔值） |

### 使用示例

```typescript
import { HttpApi, Get } from 'axios-plus';

// 基础用法：指定 baseURL
@HttpApi('https://api.example.com')
class UserApi {
  @Get('/users')
  getUserList() {} // 实际请求地址：https://api.example.com/users
}

// 完整配置
@HttpApi({
  baseURL: 'https://api.example.com',
  url: '/v1', // 路径前缀
  refAxios: customAxiosInstance, // 自定义 axios 实例
  mock: {
    on: true, // 开启全局 mock
    condition: () => process.env.NODE_ENV === 'production', // 生产环境走真实接口
  },
})
class UserApiV1 {
  @Get('/users')
  getUserList() {} // 实际请求地址：https://api.example.com/v1/users
}
```

## @Get

`@Get` 是方法级别的装饰器，用于定义 GET 请求。

### 基础用法

```typescript
@HttpApi('https://api.example.com')
class UserApi {
  // 仅指定路径
  @Get('/users')
  getUserList() {}

  // 带路径参数
  @Get('/users/{id}')
  getUserDetail() {}
}
```

### 配置选项

`@Get` 支持的配置项（`HttpMethodDecoratorConfig` 类型）继承自 axios 配置，并扩展了增强功能：

| 类别       | 配置项              | 说明                                 |
| ---------- | ------------------- | ------------------------------------ |
| 基础配置   | `url`               | 请求路径（字符串或带路径参数的模板） |
|            | `baseURL`           | 覆盖类装饰器的 `baseURL`             |
|            | `headers`           | 请求头信息                           |
|            | `timeout`           | 超时时间（毫秒）                     |
| 增强功能   | `retry`             | 重试配置（次数或详细配置）           |
|            | `debounce`          | 防抖配置（延迟时间或详细配置）       |
|            | `throttle`          | 节流配置（间隔时间或详细配置）       |
|            | `mock`              | 方法级 mock 配置（覆盖全局配置）     |
| 数据处理   | `transformRequest`  | 请求数据转换器                       |
|            | `transformResponse` | 响应数据转换器                       |
| 自定义实例 | `refAxios`          | 覆盖类装饰器的 axios 实例            |

### 完整配置示例

```typescript
@Get({
  url: '/users',
  timeout: 5000,
  headers: { 'X-Request-Type': 'list' },
  retry: { count: 3, delay: 1000 }, // 重试3次，间隔1秒
  debounce: 300, // 300ms防抖
  transformResponse: (res) => res.data, // 直接返回响应体data
  mock: {
    handlers: {
      default: () => HttpResponse.json({ code: 200, data: [] })
    }
  }
})
getUserList() {}
```

## @Post

`@Post` 用于定义 POST 请求，配置选项与 `@Get` 一致，主要区别在于默认发送请求体数据。

### 基础用法

```typescript
@HttpApi('https://api.example.com')
class UserApi {
  @Post('/users')
  createUser() {}
}
```

### 特殊说明

- 通常配合 `@BodyParam` 装饰器传递请求体数据
- 支持表单提交（`multipart/form-data`）和 JSON 提交（`application/json`）
- 配置选项与 `@Get` 完全一致，可按需设置重试、防抖等增强功能

## @Put、@Delete、@Patch

这些装饰器的使用方式与 `@Get`、`@Post` 类似，分别对应 HTTP 标准的 PUT、DELETE、PATCH 方法，用于资源的更新、删除和部分更新操作。

### 使用示例

```typescript
@HttpApi('https://api.example.com')
class UserApi {
  // 更新资源（全量更新）
  @Put('/users/{id}')
  updateUser() {}

  // 删除资源
  @Delete('/users/{id}')
  deleteUser() {}

  // 部分更新资源
  @Patch('/users/{id}')
  patchUser() {}
}
```

## @Options、@Head

- `@Options`：用于请求服务器支持的 HTTP 方法（跨域预检请求常用）
- `@Head`：类似 `@Get`，但仅返回响应头，不返回响应体

### 使用示例

```typescript
@HttpApi('https://api.example.com')
class ResourceApi {
  // 检查服务器支持的方法
  @Options('/users')
  checkUserOptions() {}

  // 获取资源头信息
  @Head('/users')
  getUserHeaders() {}
}
```

## 配置合并规则

当类装饰器（`@HttpApi`）与方法装饰器（如 `@Get`）存在相同配置时：

1. `baseURL`：方法装饰器配置覆盖类装饰器
2. `url`：类装饰器的 `url` 与方法装饰器的 `url` 自动拼接（处理斜杠）
3. `headers`：两者深度合并，方法装饰器配置优先
4. `mock`：方法装饰器配置覆盖类装饰器的同名配置，非同名配置合并
5. `refAxios`：方法装饰器配置覆盖类装饰器

这种设计允许在类级别定义公共配置，在方法级别灵活调整特殊需求。
